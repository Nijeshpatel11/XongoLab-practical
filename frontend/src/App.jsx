import React, { useState } from "react";
import { BrowserRouter as Router, Routes, Route, Link, Navigate } from "react-router-dom";
import { Avatar, Menu, MenuItem, IconButton, Typography, Box } from "@mui/material";
import Signup from "./components/Signup";
import Login from "./components/Login";
import Home from "./pages/Home";
import NotFound from "./pages/NotFound";
import CustomerList from "./components/Customer/CustomerList";
import CustomerCreatePage from "./components/Customer/CustomerCreatePage";
import EditCustomerPage from "./components/Customer/EditCustomerPage";
import "./styles/App.css";
import { ToastContainer } from "react-toastify";
import "react-toastify/dist/ReactToastify.css";


const PrivateRoute = ({ children }) => {
  const isAuthenticated = localStorage.getItem("user"); 
  return isAuthenticated ? children : <Navigate to="/login" />;
};


const PublicRoute = ({ children }) => {
  const isAuthenticated = localStorage.getItem("user"); 
  return !isAuthenticated ? children : <Navigate to="/customers" />;
};

function App() {
  const [anchorEl, setAnchorEl] = useState(null);
  const user = JSON.parse(localStorage.getItem("user")); 
  const handleMenuOpen = (event) => {
    setAnchorEl(event.currentTarget);
  };

  const handleMenuClose = () => {
    setAnchorEl(null);
  };

  const handleLogout = () => {
    localStorage.removeItem("user"); 
    setAnchorEl(null); 
    window.location.href = "/login"; 
  };

  return (
    <Router>
      <nav
        className="navbar"
        style={{
          display: "flex",
          alignItems: "center",
          justifyContent: "space-between",
          padding: "10px 20px",
          borderBottom: "1px solid #ccc",
        }}
      >
  <svg width="125" height="46" viewBox="0 0 125 46" fill="none" xmlns="http://www.w3.org/2000/svg">
<rect width="45.618" height="45.618" rx="6.29213" fill="#ABC178"/>
<path d="M11.9999 36.5872V10H17.9372L28.8783 27.8119V10H34.4795V36.5872H28.6543L17.6385 18.7379V36.5872H11.9999Z" fill="white"/>
<path d="M58.5106 13.8411H62.764L70.8893 26.9015H70.9438V13.8411H74.9519V33.309H70.6712L62.5732 20.2759H62.5187V33.309H58.5106V13.8411ZM78.1478 23.5478C78.2023 22.6389 78.4295 21.8845 78.8294 21.2847C79.2293 20.6848 79.7383 20.2031 80.3563 19.8396C80.9743 19.4761 81.6651 19.2216 82.4285 19.0761C83.2101 18.9126 83.9918 18.8308 84.7734 18.8308C85.4823 18.8308 86.2003 18.8853 86.9274 18.9944C87.6545 19.0852 88.318 19.2761 88.9178 19.5669C89.5177 19.8578 90.0084 20.2668 90.3902 20.7939C90.7719 21.3029 90.9628 21.9845 90.9628 22.8388V30.1734C90.9628 30.8096 90.9991 31.4185 91.0718 32.0002C91.1445 32.5819 91.2718 33.0181 91.4535 33.309H87.5272C87.4545 33.0908 87.3909 32.8727 87.3364 32.6546C87.3 32.4183 87.2728 32.182 87.2546 31.9457C86.6366 32.5819 85.9095 33.0272 85.0733 33.2817C84.2372 33.5362 83.3828 33.6634 82.5103 33.6634C81.8378 33.6634 81.2106 33.5816 80.629 33.418C80.0473 33.2544 79.5383 32.9999 79.1021 32.6546C78.6658 32.3092 78.3205 31.873 78.066 31.3458C77.8297 30.8187 77.7115 30.1916 77.7115 29.4645C77.7115 28.6647 77.8478 28.0103 78.1205 27.5013C78.4113 26.9742 78.7749 26.5561 79.2111 26.2471C79.6656 25.9381 80.1745 25.7109 80.738 25.5654C81.3197 25.4018 81.9014 25.2746 82.4831 25.1837C83.0647 25.0928 83.6373 25.0201 84.2008 24.9656C84.7643 24.9111 85.2642 24.8293 85.7004 24.7202C86.1367 24.6111 86.4821 24.4566 86.7365 24.2567C86.991 24.0385 87.1092 23.7295 87.091 23.3296C87.091 22.9116 87.0183 22.5844 86.8729 22.3481C86.7456 22.0936 86.5639 21.9027 86.3275 21.7755C86.1094 21.6301 85.8459 21.5392 85.5368 21.5028C85.246 21.4483 84.9279 21.421 84.5825 21.421C83.8191 21.421 83.2192 21.5846 82.783 21.9118C82.3467 22.239 82.0922 22.7843 82.0195 23.5478H78.1478ZM87.091 26.4107C86.9274 26.5561 86.7184 26.6743 86.4639 26.7651C86.2276 26.8378 85.964 26.9015 85.6732 26.956C85.4005 27.0105 85.1097 27.056 84.8007 27.0923C84.4916 27.1287 84.1826 27.1741 83.8736 27.2287C83.5828 27.2832 83.2919 27.3559 83.0011 27.4468C82.7284 27.5377 82.4831 27.6649 82.2649 27.8285C82.065 27.9739 81.9014 28.1648 81.7741 28.4011C81.6469 28.6374 81.5833 28.9373 81.5833 29.3009C81.5833 29.6462 81.6469 29.9371 81.7741 30.1734C81.9014 30.4097 82.0741 30.6005 82.2922 30.746C82.5103 30.8732 82.7648 30.9641 83.0556 31.0186C83.3465 31.0732 83.6464 31.1004 83.9554 31.1004C84.7189 31.1004 85.3096 30.9732 85.7277 30.7187C86.1458 30.4642 86.4548 30.1643 86.6547 29.8189C86.8547 29.4554 86.9728 29.0918 87.0092 28.7283C87.0637 28.3647 87.091 28.0739 87.091 27.8558V26.4107ZM96.9672 28.7283C96.9672 29.1464 97.049 29.5099 97.2126 29.8189C97.3944 30.1098 97.6216 30.3552 97.8943 30.5551C98.1669 30.7369 98.4759 30.8732 98.8213 30.9641C99.1848 31.055 99.5575 31.1004 99.9392 31.1004C100.212 31.1004 100.494 31.0732 100.784 31.0186C101.093 30.9459 101.366 30.8459 101.602 30.7187C101.857 30.5733 102.066 30.3915 102.23 30.1734C102.393 29.9371 102.475 29.6462 102.475 29.3009C102.475 28.7192 102.084 28.2829 101.303 27.9921C100.539 27.7013 99.4666 27.4104 98.0851 27.1196C97.5216 26.9924 96.9672 26.8469 96.4219 26.6833C95.8948 26.5016 95.4222 26.2744 95.0041 26.0017C94.586 25.7109 94.2497 25.3564 93.9952 24.9383C93.7408 24.5021 93.6135 23.9749 93.6135 23.3569C93.6135 22.448 93.7862 21.7028 94.1316 21.1211C94.4951 20.5394 94.9677 20.085 95.5494 19.7578C96.1311 19.4124 96.7854 19.1761 97.5125 19.0489C98.2396 18.9035 98.9849 18.8308 99.7483 18.8308C100.512 18.8308 101.248 18.9035 101.957 19.0489C102.684 19.1943 103.329 19.4397 103.893 19.7851C104.456 20.1304 104.92 20.594 105.283 21.1756C105.665 21.7391 105.892 22.4571 105.965 23.3296H102.284C102.23 22.5844 101.948 22.0845 101.439 21.83C100.93 21.5573 100.33 21.421 99.6393 21.421C99.4212 21.421 99.1848 21.4392 98.9304 21.4756C98.6759 21.4937 98.4396 21.5483 98.2215 21.6391C98.0215 21.73 97.8488 21.8664 97.7034 22.0481C97.558 22.2117 97.4853 22.4389 97.4853 22.7298C97.4853 23.0752 97.6125 23.3569 97.867 23.575C98.1215 23.7932 98.4487 23.9749 98.8486 24.1203C99.2666 24.2476 99.7393 24.3657 100.266 24.4748C100.794 24.5839 101.33 24.702 101.875 24.8293C102.439 24.9565 102.984 25.111 103.511 25.2928C104.056 25.4746 104.538 25.7199 104.956 26.029C105.374 26.3198 105.71 26.6924 105.965 27.1469C106.219 27.5831 106.347 28.1284 106.347 28.7828C106.347 29.7099 106.156 30.4915 105.774 31.1277C105.411 31.7457 104.929 32.2456 104.329 32.6273C103.729 33.009 103.038 33.2726 102.257 33.418C101.493 33.5816 100.712 33.6634 99.9119 33.6634C99.094 33.6634 98.2942 33.5816 97.5125 33.418C96.7309 33.2544 96.0311 32.9818 95.4131 32.6C94.8132 32.2183 94.3133 31.7184 93.9134 31.1004C93.5317 30.4642 93.3227 29.6735 93.2863 28.7283H96.9672ZM111.885 26.2744C111.885 26.8378 111.939 27.3923 112.048 27.9376C112.157 28.4647 112.339 28.9464 112.594 29.3827C112.866 29.8007 113.212 30.137 113.63 30.3915C114.066 30.646 114.602 30.7732 115.238 30.7732C115.875 30.7732 116.402 30.6551 116.82 30.4188C117.256 30.1643 117.601 29.8371 117.856 29.4372C118.129 29.0191 118.319 28.5465 118.428 28.0194C118.556 27.4741 118.619 26.9106 118.619 26.3289C118.619 25.7836 118.556 25.2382 118.428 24.6929C118.319 24.1476 118.138 23.6568 117.883 23.2206C117.629 22.7843 117.283 22.4299 116.847 22.1572C116.429 21.8845 115.92 21.7482 115.32 21.7482C114.684 21.7482 114.148 21.8755 113.711 22.1299C113.275 22.3844 112.921 22.7298 112.648 23.166C112.375 23.5841 112.175 24.0658 112.048 24.6111C111.939 25.1383 111.885 25.6927 111.885 26.2744ZM122.355 38.2441H118.483V31.5367H118.428C117.974 32.3001 117.338 32.8454 116.52 33.1726C115.702 33.4998 114.857 33.6634 113.984 33.6634C113.33 33.6634 112.648 33.5453 111.939 33.309C111.248 33.0545 110.612 32.6455 110.031 32.082C109.449 31.5003 108.967 30.746 108.585 29.8189C108.204 28.8737 108.013 27.7194 108.013 26.3562C108.013 25.3928 108.14 24.4566 108.395 23.5478C108.649 22.6389 109.04 21.8391 109.567 21.1484C110.094 20.4394 110.749 19.876 111.53 19.4579C112.33 19.0398 113.266 18.8308 114.339 18.8308C115.211 18.8308 116.029 19.0034 116.793 19.3488C117.574 19.676 118.183 20.2304 118.619 21.012H118.674V19.2125H122.355V38.2441Z" fill="#001A32"/>
</svg>

        <Box
          style={{
            display: "flex",
            alignItems: "center",
            gap: "20px",
          }}
        >
          <Link to="/" style={{ textDecoration: "none", color: "#000" }}>
            Home
          </Link>
          {!user && (
            <Link to="/signup" style={{ textDecoration: "none", color: "#000" }}>
              Signup
            </Link>
          )}
          {!user && (
            <Link to="/login" style={{ textDecoration: "none", color: "#000" }}>
              Login
            </Link>
          )}
          {user && (
            <Link to="/customers" style={{ textDecoration: "none", color: "#000" }}>
              Customers
            </Link>
          )}
          {user && (
            <Box display="flex" alignItems="center">
              <IconButton onClick={handleMenuOpen}>
                <Avatar>{user.data.name?.charAt(0).toUpperCase() || "U"}</Avatar> 
              </IconButton>
              <Typography variant="body1" sx={{ mr: 1 }}>
                {user.data.name || user.data.email}
              </Typography>
              <Menu
                anchorEl={anchorEl}
                open={Boolean(anchorEl)}
                onClose={handleMenuClose}
                anchorOrigin={{
                  vertical: "bottom",
                  horizontal: "right",
                }}
                transformOrigin={{
                  vertical: "top",
                  horizontal: "right",
                }}
              >
                <MenuItem onClick={handleLogout}>Logout</MenuItem>
              </Menu>
            </Box>
          )}
        </Box>
      </nav>
      <div className="container">
        <ToastContainer />
        <Routes>
      
          <Route path="/" element={<Home />} />
          <Route
            path="/signup"
            element={
              <PublicRoute>
                <Signup />
              </PublicRoute>
            }
          />
          <Route
            path="/login"
            element={
              <PublicRoute>
                <Login />
              </PublicRoute>
            }
          />

         
          <Route
            path="/customers"
            element={
              <PrivateRoute>
                <CustomerList />
              </PrivateRoute>
            }
          />
          <Route
            path="/customers/create"
            element={
              <PrivateRoute>
                <CustomerCreatePage />
              </PrivateRoute>
            }
          />
          <Route
            path="/customers/edit/:id"
            element={
              <PrivateRoute>
                <EditCustomerPage />
              </PrivateRoute>
            }
          />

          <Route path="*" element={<NotFound />} />
        </Routes>
      </div>
    </Router>
  );
}

export default App;
